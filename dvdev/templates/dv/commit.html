<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
    "http://www.w3.org/TR/html4/loose.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:py="http://genshi.edgewall.org/"
      xmlns:xi="http://www.w3.org/2001/XInclude"
      lang="en">
<xi:include href="../site.html" />
<head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>${c.project}: View repo diff and commit changes</title>
    <link rel="stylesheet" type="text/css" href="default.css" 
        py:attrs="{'href': '/default.css'}" />
    <script type="text/javascript">
    </script>
    <style type="text/css" py:content="c.css"></style>
</head><body>

<h1 class="page_title">Diff</h1>

<py:replace value="Markup(h.form(url.current(action='commit'), method='get'))"/>
<label for='message'>Commit Message:</label>
<py:replace value="Markup(h.textarea('message'))"/>
<py:replace value="Markup(h.submit('commit','Commit'))"/>
<ul>
    <li py:for="diff in c.diffs">
        <input name="${diff['filename']}" type="hidden" value="${diff['repository']}" />
        <input name="${diff['filename']}" type="checkbox" checked="checked" />
        <a href="${url.current(action='revert', repo=diff['repository'], filename=diff['filename'])}">Revert</a>
        <ul py:if="diff['relatedissues']">
            <li py:for="issue in diff['relatedissues']"><a href="${url(repository=diff['relatedissues'][issue]['repo'], controller='issues', action='show', id=issue)}">Ticket: ${diff['relatedissues'][issue]['title']}</a></li>
        </ul>
        <a href="${url(repository=diff['repository'], controller='issues')}">All Issues</a>
        <a href="${url(repository=diff['repository'], controller='issues', action='new')}">Create New Issue</a>
        <label>${diff['filename']}</label><div py:replace="Markup(diff['diff'])" />
    </li>
</ul>
<py:replace value="Markup(h.end_form())"/>

</body></html>

